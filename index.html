<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hamming Code (15,11) Simulation</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'JetBrains Mono', monospace;
        }

        .bit-cell {
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.2);
        }
        
        .bit-cell:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }

        .bit-cell:hover {
            filter: brightness(1.1);
        }

        .animate-pop {
            animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Styling for the scope highlight */
        .scope-highlight {
            box-shadow: inset 0 0 0 4px #FACC15 !important; /* Yellow-400 */
            transform: scale(1.05);
            z-index: 20;
        }

        /* Styling for the interactive list items */
        .parity-row {
            transition: background-color 0.2s;
        }
        .parity-row:hover {
            background-color: rgba(51, 65, 85, 0.8); /* slate-700 */
        }
        .parity-row.active-row {
            background-color: rgba(51, 65, 85, 1);
            border-left: 4px solid #FACC15;
            padding-left: 12px; /* Adjust for border */
        }

        @keyframes pop {
            0% { transform: scale(0.9); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen p-4 flex flex-col items-center">

    <div class="max-w-4xl w-full space-y-8">
        
        <!-- Header -->
        <div class="text-center space-y-2">
            <h1 class="text-3xl font-bold text-emerald-400">Hamming Code (15,11) Visualizer</h1>
            <p class="text-slate-400">Click a bit to flip it. <span class="text-yellow-400">Click a parity rule below to see its scope.</span></p>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Left: The Bit Grid -->
            <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">16-Bit Block</h2>
                    <div class="flex gap-2">
                        <button onclick="resetGrid()" class="px-3 py-1 text-sm bg-slate-700 hover:bg-slate-600 rounded transition">Reset (Clean)</button>
                        <button onclick="randomizeData()" class="px-3 py-1 text-sm bg-emerald-600 hover:bg-emerald-500 rounded transition">Randomize Data</button>
                    </div>
                </div>

                <div class="grid grid-cols-4 gap-3 md:gap-4 aspect-square" id="grid-container">
                    <!-- Grid generated by JS -->
                </div>

                <div class="mt-6 flex flex-wrap gap-4 text-xs md:text-sm justify-center">
                    <div class="flex items-center gap-2"><div class="w-4 h-4 bg-slate-600 rounded"></div> Data Bit</div>
                    <div class="flex items-center gap-2"><div class="w-4 h-4 bg-cyan-700 rounded"></div> Parity Bit</div>
                    <div class="flex items-center gap-2"><div class="w-4 h-4 border-2 border-red-500 rounded"></div> Detected Error</div>
                    <div class="flex items-center gap-2"><div class="w-4 h-4 border-4 border-yellow-400 rounded"></div> Scope</div>
                </div>
            </div>

            <!-- Right: The Logic/Diagnostics -->
            <div class="space-y-6">
                
                <!-- Status Panel -->
                <div id="status-panel" class="bg-slate-800 p-6 rounded-xl border border-slate-700 transition-colors duration-300">
                    <h2 class="text-xl font-bold mb-2">System Status</h2>
                    <div id="status-message" class="text-lg">Initialized.</div>
                </div>

                <!-- Parity Breakdown -->
                <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">
                    <h3 class="font-bold text-slate-300 mb-4 border-b border-slate-700 pb-2">Parity Check Breakdown</h3>
                    <p class="text-xs text-slate-500 mb-3 italic">Click a row to highlight checked bits</p>
                    <div class="space-y-1 text-sm" id="parity-details">
                        <!-- Details injected by JS -->
                    </div>
                </div>

                <!-- How it works -->
                <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700 text-sm text-slate-400">
                    <p class="mb-2"><strong class="text-slate-200">The Math:</strong></p>
                    <ul class="list-disc pl-5 space-y-1">
                        <li>Positions 1, 2, 4, 8 are <span class="text-cyan-400">Parity Bits</span>.</li>
                        <li>Position 0 is the <span class="text-blue-400">Overall Parity</span> (checks all bits).</li>
                        <li>If a parity group has an odd number of 1s, it flags the <strong>Syndrome</strong>.</li>
                        <li>Syndrome = P8*8 + P4*4 + P2*2 + P1*1.</li>
                        <li>Combined with Overall Parity, we can detect 1-bit or 2-bit errors.</li>
                    </ul>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Configuration
        const TOTAL_BITS = 16;
        const PARITY_POSITIONS = [1, 2, 4, 8]; 
        
        let bits = new Array(TOTAL_BITS).fill(0);
        let activeHighlightGroup = null; // Stores which parity group is currently highlighted (0, 1, 2, 4, 8)

        const parityGroups = {
            1: [1, 3, 5, 7, 9, 11, 13, 15],
            2: [2, 3, 6, 7, 10, 11, 14, 15],
            4: [4, 5, 6, 7, 12, 13, 14, 15],
            8: [8, 9, 10, 11, 12, 13, 14, 15]
        };

        function init() {
            randomizeData();
        }

        function isParityBit(index) {
            return PARITY_POSITIONS.includes(index) || index === 0;
        }

        function recalculateParityBits() {
            PARITY_POSITIONS.forEach(p => bits[p] = 0);
            bits[0] = 0;

            PARITY_POSITIONS.forEach(p => {
                let count = 0;
                parityGroups[p].forEach(index => {
                    if (index !== p && bits[index] === 1) count++;
                });
                bits[p] = (count % 2 === 0) ? 0 : 1;
            });

            let totalSum = 0;
            for(let i=1; i<16; i++) totalSum += bits[i];
            bits[0] = (totalSum % 2 === 0) ? 0 : 1;
        }

        function randomizeData() {
            activeHighlightGroup = null; // Clear highlight on randomize
            for (let i = 0; i < TOTAL_BITS; i++) {
                if (!isParityBit(i)) {
                    bits[i] = Math.random() > 0.5 ? 1 : 0;
                }
            }
            recalculateParityBits();
            render();
            checkErrors();
        }

        function resetGrid() {
            activeHighlightGroup = null;
            bits.fill(0);
            render();
            checkErrors();
        }

        function toggleBit(index) {
            bits[index] = bits[index] === 0 ? 1 : 0;
            render();
            checkErrors();
        }

        // NEW: Function to handle toggling the visual scope
        function toggleScopeHighlight(groupIndex) {
            if (activeHighlightGroup === groupIndex) {
                activeHighlightGroup = null; // Toggle off if already selected
            } else {
                activeHighlightGroup = groupIndex;
            }
            render();
            checkErrors(); // Re-render text list to update active row styling
        }

        function checkErrors() {
            let syndrome = 0;
            let logHTML = "";
            let overallSum = 0;

            // 1. Check Standard Hamming Groups
            PARITY_POSITIONS.forEach(p => {
                let sum = 0;
                parityGroups[p].forEach(idx => sum += bits[idx]);
                
                const isOdd = sum % 2 !== 0;
                const statusColor = isOdd ? "text-red-400 font-bold" : "text-emerald-400";
                const statusText = isOdd ? "FAIL (Odd)" : "PASS (Even)";
                
                if (isOdd) syndrome += p;

                // Highlight active row in the list
                const rowClass = (activeHighlightGroup === p) ? "parity-row active-row" : "parity-row";

                logHTML += `
                    <div class="${rowClass} flex justify-between items-center p-2 rounded cursor-pointer select-none" onclick="toggleScopeHighlight(${p})">
                        <span><span class="text-cyan-400 font-bold">P${p}</span> checks: ${parityGroups[p].join(', ')}</span>
                        <span class="${statusColor}">${statusText}</span>
                    </div>
                `;
            });

            // 2. Check Overall Parity
            bits.forEach(b => overallSum += b);
            const overallParityFail = overallSum % 2 !== 0;
            const rowClass0 = (activeHighlightGroup === 0) ? "parity-row active-row" : "parity-row";

            logHTML += `
                <div class="${rowClass0} flex justify-between items-center p-2 rounded cursor-pointer mt-2 select-none" onclick="toggleScopeHighlight(0)">
                    <span><span class="text-blue-400 font-bold">P0</span> (Overall): All Bits</span>
                    <span class="${overallParityFail ? 'text-red-400 font-bold' : 'text-emerald-400'}">${overallParityFail ? 'FAIL (Odd)' : 'PASS (Even)'}</span>
                </div>
            `;

            // 3. Determine Error State
            const statusPanel = document.getElementById('status-panel');
            const statusMessage = document.getElementById('status-message');
            
            // Note: We don't clear all styling here anymore because render() handles the scope highlights.
            // We just need to handle the red error ring.
            
            // Remove OLD error rings first (keep scope highlights)
            document.querySelectorAll('.bit-cell').forEach(el => {
                el.classList.remove('ring-4', 'ring-red-500', 'z-10');
                // Ensure scope highlight remains if active (handled by render, but let's be safe)
            });

            if (syndrome === 0 && !overallParityFail) {
                statusPanel.className = "bg-emerald-900/20 p-6 rounded-xl border border-emerald-500/50 transition-colors duration-300";
                statusMessage.innerHTML = `<span class="text-emerald-400">✓ Data Integrity Verified. No errors.</span>`;
            } else if (syndrome !== 0 && overallParityFail) {
                statusPanel.className = "bg-red-900/20 p-6 rounded-xl border border-red-500/50 transition-colors duration-300 animate-pulse";
                statusMessage.innerHTML = `
                    <div class="flex flex-col">
                        <span class="text-red-400 font-bold">⚠ SINGLE BIT ERROR DETECTED</span>
                        <span class="text-sm mt-1">Syndrome: ${syndrome} | Overall Parity: Fail</span>
                        <span class="text-sm">Logic identifies Bit #${syndrome} as corrupted.</span>
                    </div>
                `;
                const errorCell = document.getElementById(`cell-${syndrome}`);
                if (errorCell) errorCell.classList.add('ring-4', 'ring-red-500', 'z-10');

            } else if (syndrome === 0 && overallParityFail) {
                statusPanel.className = "bg-red-900/20 p-6 rounded-xl border border-red-500/50 transition-colors duration-300 animate-pulse";
                statusMessage.innerHTML = `
                    <div class="flex flex-col">
                        <span class="text-red-400 font-bold">⚠ PARITY BIT ERROR</span>
                        <span class="text-sm mt-1">Syndrome: 0 | Overall Parity: Fail</span>
                        <span class="text-sm">The Overall Parity Bit (Bit #0) is corrupted.</span>
                    </div>
                `;
                 const errorCell = document.getElementById(`cell-0`);
                 if (errorCell) errorCell.classList.add('ring-4', 'ring-red-500', 'z-10');

            } else if (syndrome !== 0 && !overallParityFail) {
                statusPanel.className = "bg-orange-900/20 p-6 rounded-xl border border-orange-500/50 transition-colors duration-300";
                statusMessage.innerHTML = `
                    <div class="flex flex-col">
                        <span class="text-orange-400 font-bold">⚠ DOUBLE BIT ERROR DETECTED</span>
                        <span class="text-sm mt-1">Syndrome: ${syndrome} | Overall Parity: OK</span>
                        <span class="text-sm">Two bits are flipped. Correction impossible. Location aliased to #${syndrome}.</span>
                    </div>
                `;
            }

            document.getElementById('parity-details').innerHTML = logHTML;
        }

        function render() {
            const container = document.getElementById('grid-container');
            container.innerHTML = '';

            bits.forEach((bitVal, index) => {
                const el = document.createElement('div');
                el.id = `cell-${index}`;
                
                let bgClass = "bg-slate-600"; 
                let textClass = "text-slate-200";
                let label = "D";

                if (index === 0) {
                    bgClass = "bg-blue-900";
                    label = "OP"; 
                } else if (PARITY_POSITIONS.includes(index)) {
                    bgClass = "bg-cyan-700";
                    label = `P${index}`;
                }

                if (bitVal === 1) {
                    textClass = "text-white font-bold";
                } else {
                    textClass = "text-slate-400";
                }

                el.className = `bit-cell ${bgClass} rounded-lg flex flex-col items-center justify-center relative select-none animate-pop`;
                el.onclick = () => toggleBit(index);

                // --- SCOPE HIGHLIGHT LOGIC ---
                if (activeHighlightGroup !== null) {
                    let shouldHighlight = false;
                    
                    if (activeHighlightGroup === 0) {
                        // P0 checks everyone
                        shouldHighlight = true;
                    } else if (parityGroups[activeHighlightGroup] && parityGroups[activeHighlightGroup].includes(index)) {
                        // Standard parity groups check specific indices
                        shouldHighlight = true;
                    }

                    if (shouldHighlight) {
                        el.classList.add('scope-highlight');
                    } else {
                        // Optional: Dim bits that aren't involved to make highlight pop more
                        el.style.opacity = '0.3';
                    }
                }

                el.innerHTML = `
                    <span class="absolute top-1 left-2 text-[10px] uppercase opacity-50 tracking-wider">${index}</span>
                    <span class="text-4xl ${textClass}">${bitVal}</span>
                    <span class="absolute bottom-1 right-2 text-[10px] text-cyan-300 opacity-70">${label}</span>
                `;

                container.appendChild(el);
            });
        }

        init();

    </script>
</body>
</html>